--1. top 10 categories
SELECT 
    p.CATEGORY_NAME, 
    SUM(f.SPEND_AMOUNT_USD) as total_spend
FROM fact_sales f
JOIN dim_product p ON f.dim_productid = p.dim_productid
WHERE p.CATEGORY_NAME IS NOT NULL 
  AND p.CATEGORY_NAME NOT IN ('Unknown', 'n/a', 'Other') -- Kiszűrjük a felesleget
GROUP BY p.CATEGORY_NAME
ORDER BY total_spend DESC 
LIMIT 10;

--2.daily sales
SELECT 
    d.date, 
    SUM(f.SPEND_AMOUNT_USD) as daily_spend
FROM fact_sales f
JOIN dim_date d ON f.dim_dateid = d.dim_dateid
GROUP BY d.date
ORDER BY d.date;

--3.transaction value/item count
SELECT 
    d.date, 
    SUM(f.SPEND_AMOUNT_USD) as daily_spend
FROM fact_sales f
JOIN dim_date d ON f.dim_dateid = d.dim_dateid
GROUP BY d.date
ORDER BY d.date;

--4.busiest days of the week/month
SELECT 
    d.day_of_week_name,
    d.month,
    SUM(f.SPEND_AMOUNT_USD) as total_revenue
FROM fact_sales f
JOIN dim_date d ON f.dim_dateid = d.dim_dateid
GROUP BY d.day_of_week_name, d.month
ORDER BY SUM(f.SPEND_AMOUNT_USD) DESC;

--5.avg transaction value
SELECT 
    ROUND(AVG(SPEND_AMOUNT_USD), 2) as avg_basket_value
FROM fact_sales;

--6.revenue by merchant channel
SELECT 
    m.MERCHANT_CHANNEL, 
    SUM(f.SPEND_AMOUNT_USD) as total_revenue
FROM fact_sales f
JOIN dim_merchant m ON f.dim_merchantid = m.dim_merchantid
GROUP BY 1
ORDER BY 2 DESC;
